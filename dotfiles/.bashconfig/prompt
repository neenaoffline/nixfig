#!/usr/bin/env bash

# Everything below is at least partially ChatGPT's fault

# ---[ Load git-prompt ]---
# (this file ships with git; paths vary slightly by distro)
if [ -f /usr/share/git/completion/git-prompt.sh ]; then
	. /usr/share/git/completion/git-prompt.sh
elif [ -f /etc/bash_completion.d/git-prompt ]; then
	. /etc/bash_completion.d/git-prompt
elif [ -f /usr/share/git-core/contrib/completion/git-prompt.sh ]; then
	. /usr/share/git-core/contrib/completion/git-prompt.sh
elif [ -f /run/current-system/sw/share/bash-completion/completions/git-prompt.sh ]; then
	# NixOS system-wide
	. /run/current-system/sw/share/bash-completion/completions/git-prompt.sh
elif command -v git >/dev/null 2>&1; then
	# Nix (home-manager or nix-shell): find git-prompt.sh relative to git binary
	_git_prompt_path="$(dirname "$(dirname "$(command -v git)")")/share/bash-completion/completions/git-prompt.sh"
	[ -f "$_git_prompt_path" ] && . "$_git_prompt_path"
	unset _git_prompt_path
fi

# ---[ Color definitions ]---
# Use \[ \] to wrap non-printing sequences so readline keeps cursor position correct
# These are standard ANSI colors
RESET='\[\033[0m\]'
BOLD='\[\033[1m\]'
RED='\[\033[0;31m\]'
GREEN='\[\033[0;32m\]'
YELLOW='\[\033[0;33m\]'
BLUE='\[\033[0;34m\]'
MAGENTA='\[\033[0;35m\]'
CYAN='\[\033[0;36m\]'
WHITE='\[\033[0;37m\]'

# ---[ Git branch color setup ]---
# Colors the branch name in yellow inside parentheses
GIT_PS1_SHOWDIRTYSTATE=true  # optional: shows '*' if dirty, '+' if staged
GIT_PS1_SHOWUNTRACKEDFILES=true
GIT_PS1_SHOWUPSTREAM=auto

# ---[ Prompt ]---
# \u = user, \h = host, \w = cwd, \$ = # or $
# __git_ps1 adds " (branch)" if inside a git repo
PS1="${BOLD}${GREEN}\u@\h${RESET}:${BLUE}\w${YELLOW}\$(__git_ps1 ' (%s)')${RESET}\$ "
